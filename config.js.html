<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: config.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: config.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Module de configuration de l'application
 * @module config
 */
import moment from 'moment'

/**
 *
 * Détermine si l'application tourne en mode production
 * @constant {boolean} isProduction
 */
const isProduction = process.env.NODE_ENV === 'production'

/**
 * URL d'accès à l'application, important pour la configuration du router vue-router
 * @constant {string} DEFAULT_PUBLIC_URL
 */
const DEFAULT_PUBLIC_URL = isProduction
  ? 'https://beta.interieur.gouv.fr/candilib'
  : 'http://localhost:8080/candilib'

const DEFAULT_ADMIN_URL = 'http://localhost:8080/candilib'

/**
 * Dictionnaire des différents types de statuts des utilisateurs de l'application
 * @constant {object}
 */
const userStatuses = {
  CANDIDAT: 'candidat',
  REPARTITEUR: 'repartiteur',
  DELEGUE: 'delegue',
  ADMIN: 'admin',
  TECH: 'tech',
}

/**
 * Dictionnaire des différents niveaux de permission des utilisateurs de l'application
 * @constant {object}
 */
const userStatusLevels = {
  [userStatuses.CANDIDAT]: 0,
  [userStatuses.REPARTITEUR]: 1,
  [userStatuses.DELEGUE]: 2,
  [userStatuses.ADMIN]: 3,
  [userStatuses.TECH]: 4,
}

/**
 * Dictionnaire des fonctionnalitées à activer ou non
 * @constant {object}
 */
const features = {
  AURIGE: 'aurige',
  STATS_KPI: 'stats-kpi',
}

/**
 * Dictionnaire des différentes fonctionnalités accessibles selon le type d'utilisateurs de l'application
 * @constant {object}
 */
const userStatusAccess = {
  [userStatuses.CANDIDAT]: [],
  [userStatuses.REPARTITEUR]: [],
  [userStatuses.DELEGUE]: [features.STATS_KPI],
  [userStatuses.ADMIN]: [features.AURIGE, features.STATS_KPI],
  [userStatuses.TECH]: [features.AURIGE, features.STATS_KPI],
}

/**
 * Calcule la date d'expiration du token en ajoutant un jour à la date courante
 *
 * @function getTokenExpiration
 * @returns {string} Example : '36000s'
 */

const getTokenExpiration = () => {
  const now = moment()
  const midnight = now
    .clone()
    .hour(23)
    .minute(59)
    .second(59)
    .millisecond(0)

  if (midnight.isBefore(now)) {
    midnight.add(1, 'days')
  }

  const duration = midnight.diff(now) / 1000

  return duration + 's'
}

const config = {
  secret: process.env.SECRET || 'secret',
  candidatTokenExpiration: process.env.CANDIDAT_EXPIREDIN || '3d',
  get repartiteurTokenExpiration () {
    return getTokenExpiration()
  },
  get delegueTokenExpiration () {
    return getTokenExpiration()
  },
  get adminTokenExpiration () {
    return getTokenExpiration()
  },
  get techTokenExpiration () {
    return process.env.TECH_EXPIREDIN || '1h'
  },

  userStatuses,
  features,

  userStatusLevels,
  userStatusFeatures: userStatusAccess,

  dbName: process.env.DB_NAME,
  dbUser: process.env.DB_USER,
  dbPass: process.env.DB_PASS,

  mailFrom: process.env.MAIL_FROM || 'noreply@localhost.com',

  smtpServer: process.env.SMTP_SERVER || 'localhost',
  smtpService: process.env.SMTP_SERVICE || undefined,
  smtpUser: process.env.SMTP_USER,
  smtpPass: process.env.SMTP_PASS,
  smtpPort: process.env.SMTP_PORT || 25,

  PUBLIC_URL: process.env.PUBLIC_URL || DEFAULT_PUBLIC_URL,
  ADMIN_URL: process.env.ADMIN_URL || DEFAULT_ADMIN_URL,
  CANDIDAT_ROUTE: '/candidat',
  ADMIN_ROUTE: '/admin',

  delayToBook:
    process.env.DELAY_TO_BOOK !== undefined
      ? Number(process.env.DELAY_TO_BOOK)
      : 7,
  timeoutToRetry:
    process.env.TIMEOUT_TO_RETRY !== undefined
      ? Number(process.env.TIMEOUT_TO_RETRY)
      : 45,
  daysForbidCancel:
    process.env.DAYS_FORBID_CANCEL !== undefined
      ? Number(process.env.DAYS_FORBID_CANCEL)
      : 7,
  numberOfVisibleMonths:
    process.env.NUMBER_VISIBLE_MONTHS !== undefined
      ? Number(process.env.NUMBER_VISIBLE_MONTHS)
      : 3,
}

/**
 * Données de connexion à la base de données
 * @constant {object}
 */
export const dbOptions = {
  db: config.dbName,
  user: config.dbUser,
  pass: config.dbPass,
}

/**
 * Données de connexion au serveur de SMTP pour les envois de mail
 * @constant {object}
 */
export const smtpOptions = {
  host: config.smtpServer,
  port: config.smtpPort,
  secure: false,
  tls: {
    // do not failed with selfsign certificates
    rejectUnauthorized: false,
  },
}

if (config.smtpUser) {
  smtpOptions.auth = {
    user: config.smtpUser,
    pass: config.smtpPass,
  }
}

export default config
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li><li><a href="module-business_send-mail-confirmation-new-password.html">business/send-mail-confirmation-new-password</a></li><li><a href="module-business_send-mail-reset-password.html">business/send-mail-reset-password</a></li><li><a href="module-config.html">config</a></li><li><a href="module-index.html">index</a></li><li><a href="module-models_archived-place_archived-place-model.html">models/archived-place/archived-place-model</a></li><li><a href="module-models_archived-place_archived-place-queries.html">models/archived-place/archived-place-queries</a></li><li><a href="module-models_place_place-model.html">models/place/place-model</a></li><li><a href="module-models_place_place-queries.html">models/place/place-queries</a></li><li><a href="module-routes.html">routes</a></li><li><a href="module-routes_admin.html">routes/admin</a></li><li><a href="module-routes_admin_admin-controllers.html">routes/admin/admin-controllers</a></li><li><a href="module-routes_admin_candidats-controllers.html">routes/admin/candidats-controllers</a></li><li><a href="module-routes_admin_inspecteurs-controllers.html">routes/admin/inspecteurs-controllers</a></li><li><a href="module-routes_admin_places-business.html">routes/admin/places-business</a></li><li><a href="module-routes_admin_places-controllers.html">routes/admin/places-controllers</a></li><li><a href="module-routes_admin_statistics-controllers.html">routes/admin/statistics-controllers</a></li><li><a href="module-routes_admin_verify-access-aurige.html">routes/admin/verify-access-aurige</a></li><li><a href="module-routes_admin_verify-repartiteur-departement.html">routes/admin/verify-repartiteur-departement</a></li><li><a href="module-routes_admin_whitelisted-controllers.html">routes/admin/whitelisted-controllers</a></li><li><a href="module-routes_auth.html">routes/auth</a></li><li><a href="module-routes_auth_admin-controllers.html">routes/auth/admin-controllers</a></li><li><a href="module-routes_auth_candidat-controllers.html">routes/auth/candidat-controllers</a></li><li><a href="module-routes_candidat.html">routes/candidat</a></li><li><a href="module-routes_candidat_candidat-controllers.html">routes/candidat/candidat-controllers</a></li><li><a href="module-routes_candidat_places-business.html">routes/candidat/places-business</a></li><li><a href="module-routes_candidat_places-controllers.html">routes/candidat/places-controllers</a></li><li><a href="module-routes_middlewares_verify-token.html">routes/middlewares/verify-token</a></li><li><a href="module-util_date-util.html">util/date-util</a></li></ul><h3>Classes</h3><ul><li><a href="ErrorWithStatus.html">ErrorWithStatus</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addEmailValidationHash">addEmailValidationHash</a></li><li><a href="global.html#addPlaceToArchive">addPlaceToArchive</a></li><li><a href="global.html#archivePlace">archivePlace</a></li><li><a href="global.html#cancelBookingAfterExamFailure">cancelBookingAfterExamFailure</a></li><li><a href="global.html#createCandidat">createCandidat</a></li><li><a href="global.html#deleteCandidat">deleteCandidat</a></li><li><a href="global.html#deleteCandidatByNomNeph">deleteCandidatByNomNeph</a></li><li><a href="global.html#findAllCandidatsLean">findAllCandidatsLean</a></li><li><a href="global.html#findBookedCandidats">findBookedCandidats</a></li><li><a href="global.html#findCandidatByEmail">findCandidatByEmail</a></li><li><a href="global.html#findCandidatById">findCandidatById</a></li><li><a href="global.html#findCandidatByNomNeph">findCandidatByNomNeph</a></li><li><a href="global.html#findCandidatsMatching">findCandidatsMatching</a></li><li><a href="global.html#findCentreByName">findCentreByName</a></li><li><a href="global.html#findUserByEmail">findUserByEmail</a></li><li><a href="global.html#isCandidatExisting">isCandidatExisting</a></li><li><a href="global.html#setCandidatFirstConnection">setCandidatFirstConnection</a></li><li><a href="global.html#setCandidatToVIP">setCandidatToVIP</a></li><li><a href="global.html#updateCandidatById">updateCandidatById</a></li><li><a href="global.html#updateCandidatCanBookFrom">updateCandidatCanBookFrom</a></li><li><a href="global.html#updateCandidatEmail">updateCandidatEmail</a></li><li><a href="global.html#updateCandidatFailed">updateCandidatFailed</a></li><li><a href="global.html#updateCandidatNoReussite">updateCandidatNoReussite</a></li><li><a href="global.html#updateCandidatSignUp">updateCandidatSignUp</a></li><li><a href="global.html#updateUserPassword">updateUserPassword</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Nov 13 2019 17:03:51 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
